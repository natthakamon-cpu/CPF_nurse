<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</title>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
      * { box-sizing: border-box; }
      .header { font-size: 16px; }
      body { font-family: "Sarabun", sans-serif; background: #f4f6f8; margin: 0; }
      .container { font-size: 24px; }

      .header {
        width: 100%;
        background: #ffffff;
        border-bottom: 1px solid #e0e0e0;
        padding: 14px 40px;
        display: flex; align-items: center; justify-content: space-between;
      }
      .header-left { display: flex; align-items: center; gap: 12px; font-size: 20px; font-weight: 700; color: #5b2c83; }
      .header-left i { font-size: 26px; }
      .header-right { display: flex; align-items: center; gap: 16px; font-size: 14px; }
      .logout-btn { background: #ff6b6b; color: #fff; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; }
      .label-bold { font-weight: 700; }

      .q-row, .doctor-row, .line-group { margin-bottom: 22px; }
      label { display: block; margin-bottom: 10px; }
      input, textarea, select { margin-top: 6px; }

      .option-row input[type="radio"] { transform: scale(1.6); margin-right: 6px; }
      .option-row label { font-size: 22px; }

      .paper { position: relative; max-width: 1500px; margin: 40px auto; background: #fff; padding: 40px; border-radius: 14px; box-shadow: 0 8px 25px rgba(0,0,0,0.25); }
      h2 { text-align: center; margin-top: 10px; margin-bottom: 30px; font-size: 32px; font-weight: 700; }

      .paper > a.save-btn {
        position: absolute; top: 15px; left: 15px;
        background: #28a745; color: #fff; padding: 10px 18px; border-radius: 8px;
        font-size: 18px; font-weight: 600; text-decoration: none;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      }
      .paper > a.save-btn:hover { background: #218838; }

      .tab { text-align: center; margin-bottom: 25px; }
      .tab button {
        padding: 18px 32px; margin: 0 10px; font-size: 24px; font-weight: 600;
        border: none; border-radius: 14px; cursor: pointer; color: #fff;
        background: linear-gradient(135deg, #1e88e5, #90caf9);
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      }
      .tab button:hover { transform: translateY(-3px); }

      .section-title, b { font-size: 24px; font-weight: 700; margin-top: 14px; }
      .form-title { font-size: 32px; font-weight: 700; text-align: center; }

      input, textarea, select { width: 100%; padding: 14px; font-size: 24px; border-radius: 14px; border: 1px solid #bbb; }
      .save-btn, .print-btn {
        margin-top: 24px; padding: 18px 32px; font-size: 24px; font-weight: 600;
        border: none; border-radius: 14px; cursor: pointer; color: #fff;
        background: linear-gradient(135deg, #1e88e5, #90caf9);
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      }
      .print-btn { margin-left: 10px; }

      .health-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
      .doctor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 10px; }
      .doctor-col { min-width: 0; }
      .option-row { display: flex; align-items: center; gap: 10px; }

      .hide { display: none; }

      .footer { width: 100%; background: #dcdcdc; text-align: center; padding: 18px; font-size: 14px; color: #555; margin-top: 60px; }
    </style>
  </head>

  <body>
    <div class="header">
      <div class="header-left">
        <i class="fa-solid fa-stethoscope"></i>
        ‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• CPF ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô
      </div>
      <div class="header-right">
        {{ session.get('user_name', 'User') }} ({{ session.get('role', 'user') }}) | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô Safety
        <a href="/logout" class="logout-btn">‡∏≠‡∏≠‡∏Å</a>
      </div>
    </div>

    <div class="container">
      <div class="paper">
        <h2>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</h2>

        <a href="/medical_certificate" class="save-btn">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>

        <div class="tab" id="menu">
          <button type="button" onclick="showPart(1)">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</button>
          <button type="button" onclick="showPart(2)">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡πÅ‡∏û‡∏ó‡∏¢‡πå</button>
        </div>

        <!-- ========= PART 1 ========= -->
        <form id="part1">
          <div class="form-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</div>

          <div class="q-row">
            <label class="label-bold">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
            <select name="title">
              <option>‡∏ô‡∏≤‡∏¢</option>
              <option>‡∏ô‡∏≤‡∏á</option>
              <option>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
            </select>
          </div>

          <div class="q-row">
            <label class="label-bold">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input name="fullname" type="text" />
          </div>

          <div class="q-row">
            <label class="label-bold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <textarea name="address"></textarea>
          </div>

          <div class="q-row">
            <label class="label-bold">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
            <input type="text" name="citizenId" />
          </div>

          <div class="section-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</div>

          <div class="health-grid">
            <div class="line-group">
              1) ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß
              <div class="option-row">
                <label><input type="radio" name="disease" value="‡πÑ‡∏°‡πà‡∏°‡∏µ" /> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
                <label><input type="radio" name="disease" value="‡∏°‡∏µ" /> ‡∏°‡∏µ</label>
                <input type="text" name="disease_detail" placeholder="‡∏£‡∏∞‡∏ö‡∏∏" />
              </div>
            </div>

            <div class="line-group">
              2) ‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î
              <div class="option-row">
                <label><input type="radio" name="accident" value="‡πÑ‡∏°‡πà‡∏°‡∏µ" /> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
                <label><input type="radio" name="accident" value="‡∏°‡∏µ" /> ‡∏°‡∏µ</label>
                <input type="text" name="accident_detail" placeholder="‡∏£‡∏∞‡∏ö‡∏∏" />
              </div>
            </div>

            <div class="line-group">
              3) ‡πÄ‡∏Ñ‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
              <div class="option-row">
                <label><input type="radio" name="hospital_history" value="‡πÑ‡∏°‡πà‡∏°‡∏µ" /> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
                <label><input type="radio" name="hospital_history" value="‡∏°‡∏µ" /> ‡∏°‡∏µ</label>
                <input type="text" name="hospital_history_detail" placeholder="‡∏£‡∏∞‡∏ö‡∏∏" />
              </div>
            </div>

            <div class="line-group">
              4) ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
              <textarea name="other_history"></textarea>
            </div>
          </div>

          <div class="doctor-grid">
            <div class="doctor-col">
              <label class="section-title">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</label>
              <input type="text" name="signer" />
            </div>

            <div class="doctor-col">
              <label class="section-title">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
              <input type="date" name="date" />
            </div>
          </div>

          <button type="button" class="save-btn" id="savePart1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1</button>
          <button type="button" class="print-btn" id="printBtn1">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</button>
        </form>

        <!-- ========= PART 2 ========= -->
        <form id="part2" class="hide">
          <div class="form-title">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</div>

          <div class="doctor-grid">
            <div class="doctor-col">
              <div class="doctor-row">
                <label class="section-title">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå</label>
                <input name="doctor_name" />
              </div>

              <div class="doctor-row">
                <label class="section-title">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</label>
                <input name="hospital_name" placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• / ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å" />
              </div>

              <div class="doctor-row">
                <label class="section-title">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</label>
                <textarea name="hospital_address" rows="2"></textarea>
              </div>

              <div class="doctor-row">
                <label class="section-title">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</label>
                <div style="display:flex; gap:10px; flex-wrap:wrap">
                  <input name="weight" type="text" placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)" style="width:120px" />
                  <input name="height" type="text" placeholder="‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)" style="width:120px" />
                  <input name="bp" type="text" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô (mmHg)" style="width:140px" />
                  <input name="pulse" type="text" placeholder="‡∏ä‡∏µ‡∏û‡∏à‡∏£ (‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ)" style="width:140px" />
                </div>
              </div>
            </div>

            <div class="doctor-col">
              <div class="doctor-row">
                <label class="section-title">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</label>
                <input name="certificate_no" placeholder="‡πÄ‡∏ä‡πà‡∏ô MC-20260203-12345" />
              </div>

              <div class="doctor-row">
                <label class="section-title">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û</label>
                <input name="license" />
              </div>

              <div class="doctor-row">
                <label class="section-title">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à</label>
                <input type="date" name="exam_date" />
              </div>

              <div class="doctor-row">
                <label class="section-title">‡∏™‡∏†‡∏≤‡∏û‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå</label>
                <input name="body_status" placeholder="‡∏õ‡∏Å‡∏ï‡∏¥ / ‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥" />
              </div>
            </div>
          </div>

          <p style="text-indent:2em; line-height:1.4">
            ‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ß‡πà‡∏≤ ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏∏‡∏û‡∏û‡∏•‡∏†‡∏≤‡∏û‡∏à‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
            ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏à‡∏¥‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏¥‡∏ï‡∏ü‡∏±‡πà‡∏ô‡πÄ‡∏ü‡∏∑‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏≠‡πà‡∏≠‡∏ô
            ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÇ‡∏ó‡∏© ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏û‡∏¥‡∏©‡∏™‡∏∏‡∏£‡∏≤‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á
            ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ
          </p>

          <div>(1) ‡πÇ‡∏£‡∏Ñ‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏à‡πÅ‡∏Å‡πà‡∏™‡∏±‡∏á‡∏Ñ‡∏°</div>
          <div>(2) ‡∏ß‡∏±‡∏ì‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</div>
          <div>(3) ‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏à‡πÅ‡∏Å‡πà‡∏™‡∏±‡∏á‡∏Ñ‡∏°</div>
          <div>
            (4) ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            <input name="other_disease" type="text" style="width:70%" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" />
          </div>

          <div style="margin-top:20px">
            <div style="margin-bottom:12px">
              <label class="section-title">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô / ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</label>
              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px">
                <label><input type="radio" name="work_result" value="‡πÑ‡∏î‡πâ" /> ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</label>
                <label><input type="radio" name="work_result" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" /> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</label>
              </div>
            </div>

            <div style="margin-bottom:12px">
              <label class="section-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
              <textarea name="body_detail" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
            </div>

            <div>
              <label class="section-title">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</label>
              <input name="doctor_sign" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°" />
            </div>
          </div>

          <button type="button" class="save-btn" id="savePart2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2</button>
          <button type="button" class="print-btn" id="printBtn">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</button>
        </form>
      </div>

      <script>
        function showPart(part) {
          document.getElementById("part1").classList.add("hide");
          document.getElementById("part2").classList.add("hide");
          document.getElementById("part" + part).classList.remove("hide");

          if (part === 2 && tempPart1Data && tempPart1Data.certificate_no) {
            const p2 = document.getElementById("part2");
            const el = p2.querySelector('[name="certificate_no"]');
            if (el && !String(el.value || "").trim()) el.value = tempPart1Data.certificate_no;
          }
        }

        function getVal(root, selectors, fallback = "") {
          for (const sel of selectors) {
            const el = root.querySelector(sel);
            if (el) return (el.value ?? "").toString();
          }
          return fallback;
        }
        function getRadio(root, name, fallback = "") {
          const el = root.querySelector(`[name="${name}"]:checked`);
          return el ? el.value : fallback;
        }

        function genCertificateNo() {
          const d = new Date();
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          const tail = String(Date.now()).slice(-5);
          return `MC-${y}${m}${day}-${tail}`;
        }

        let tempPart1Data = null;

        document.getElementById("savePart1").addEventListener("click", function () {
          const p1 = document.getElementById("part1");
          const certNo = (tempPart1Data && tempPart1Data.certificate_no) || genCertificateNo();

          tempPart1Data = {
            certificate_no: certNo,

            title: getVal(p1, ['[name="title"]', "select"]),
            fullname: getVal(p1, ['[name="fullname"]']),
            address: getVal(p1, ['[name="address"]']),
            citizenId: getVal(p1, ['[name="citizenId"]']),

            disease: getRadio(p1, "disease", ""),
            disease_detail: getVal(p1, ['[name="disease_detail"]']),

            accident: getRadio(p1, "accident", ""),
            accident_detail: getVal(p1, ['[name="accident_detail"]']),

            hospital: getRadio(p1, "hospital_history", ""),
            hospital_detail: getVal(p1, ['[name="hospital_history_detail"]']),

            other_history: getVal(p1, ['[name="other_history"]']),
            requester_sign: getVal(p1, ['[name="signer"]']),
            requester_date: getVal(p1, ['[name="date"]'])
          };

          alert("‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏ï‡πà‡∏≠");
          showPart(2);
        });

        document.getElementById("printBtn1").addEventListener("click", function () {
          const p1 = document.getElementById("part1");
          const certNo = (tempPart1Data && tempPart1Data.certificate_no) || genCertificateNo();

          const printData = {
            certificate_no: certNo,
            title: getVal(p1, ['[name="title"]', "select"]),
            fullname: getVal(p1, ['[name="fullname"]']),
            address: getVal(p1, ['[name="address"]']),
            citizenId: getVal(p1, ['[name="citizenId"]']),
            disease: getRadio(p1, "disease", ""),
            disease_detail: getVal(p1, ['[name="disease_detail"]']),
            accident: getRadio(p1, "accident", ""),
            accident_detail: getVal(p1, ['[name="accident_detail"]']),
            hospital: getRadio(p1, "hospital_history", ""),
            hospital_detail: getVal(p1, ['[name="hospital_history_detail"]']),
            other_history: getVal(p1, ['[name="other_history"]']),
            requester_sign: getVal(p1, ['[name="signer"]']),
            requester_date: getVal(p1, ['[name="date"]'])
          };

          localStorage.setItem("tempCertificateData", JSON.stringify(printData));
          window.open("/medical_certificate/print", "_blank");
        });

        document.getElementById("savePart2").addEventListener("click", async function () {
          if (!tempPart1Data) {
            alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Å‡πà‡∏≠‡∏ô");
            showPart(1);
            return;
          }

          const p2 = document.getElementById("part2");
          const certNo =
            getVal(p2, ['[name="certificate_no"]']) ||
            tempPart1Data.certificate_no ||
            genCertificateNo();

          tempPart1Data.certificate_no = certNo;

          const finalRecord = {
            ...tempPart1Data,

            doctor_name: getVal(p2, ['[name="doctor_name"]']),
            hospital_name: getVal(p2, ['[name="hospital_name"]']),
            hospital_address: getVal(p2, ['[name="hospital_address"]']),
            weight: getVal(p2, ['[name="weight"]']),
            height: getVal(p2, ['[name="height"]']),
            bp: getVal(p2, ['[name="bp"]']),
            pulse: getVal(p2, ['[name="pulse"]']),
            exam_date: getVal(p2, ['[name="exam_date"]']),
            license: getVal(p2, ['[name="license"]']),
            certificate_no: certNo,
            body_status: getVal(p2, ['[name="body_status"]']),
            body_detail: getVal(p2, ['[name="body_detail"]']),
            other_disease: getVal(p2, ['[name="other_disease"]']),
            work_result: getRadio(p2, "work_result", ""),
            doctor_sign: getVal(p2, ['[name="doctor_sign"]'])
          };

          try {
            const response = await fetch("/api/medical_certificate/add", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(finalRecord)
            });

            const result = await response.json();
            const ok = !!(result && (result.success || result.ok));

            if (ok) {
              alert("‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
              tempPart1Data = null;
              window.location.href = "/medical_certificate/register";
            } else {
              alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + (result.message || "Unknown error"));
            }
          } catch (error) {
            console.error("Error saving certificate:", error);
            alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + error.message);
          }
        });

        document.getElementById("printBtn").addEventListener("click", function () {
          if (!tempPart1Data) {
            alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Å‡πà‡∏≠‡∏ô");
            showPart(1);
            return;
          }

          const p2 = document.getElementById("part2");
          const certNo =
            getVal(p2, ['[name="certificate_no"]']) ||
            tempPart1Data.certificate_no ||
            genCertificateNo();

          tempPart1Data.certificate_no = certNo;

          const printData = {
            ...tempPart1Data,

            doctor_name: getVal(p2, ['[name="doctor_name"]']),
            hospital_name: getVal(p2, ['[name="hospital_name"]']),
            hospital_address: getVal(p2, ['[name="hospital_address"]']),
            weight: getVal(p2, ['[name="weight"]']),
            height: getVal(p2, ['[name="height"]']),
            bp: getVal(p2, ['[name="bp"]']),
            pulse: getVal(p2, ['[name="pulse"]']),
            exam_date: getVal(p2, ['[name="exam_date"]']),
            license: getVal(p2, ['[name="license"]']),
            certificate_no: certNo,
            body_status: getVal(p2, ['[name="body_status"]']),
            body_detail: getVal(p2, ['[name="body_detail"]']),
            other_disease: getVal(p2, ['[name="other_disease"]']),
            work_result: getRadio(p2, "work_result", ""),
            doctor_sign: getVal(p2, ['[name="doctor_sign"]'])
          };

          localStorage.setItem("tempCertificateData", JSON.stringify(printData));
          window.open("/medical_certificate/print", "_blank");
        });
      </script>
    </div>

    <div class="footer">¬© 2025 Safety Officer, CPF Khon Kaen Feedmill</div>
  </body>
</html>
